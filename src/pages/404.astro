---
import { getGlobalStory } from '~/features/common/api'
import { getPageNotFoundStory } from '~/features/errors/api'
import { getCurrentTheme } from '~/features/themes'
import HtmlDocument from '~/features/common/HtmlDocument/index.astro'
import DefaultSeoMetadata from '~/features/common/DefaultSeoMetadata/index.astro'
import DefaultLayout from '~/features/common/DefaultLayout/index.astro'
import PageNotFoundPage from '~/features/errors/PageNotFoundPage/index.astro'

const global = await getGlobalStory()

if (!global) {
  throw Error(`'Global' story not found.`)
}

// TODO: Can just create metadata now instead of a whole story
const story = getPageNotFoundStory()

const currentTheme = getCurrentTheme(Astro.cookies, true)
---

<HtmlDocument theme={currentTheme}>
  <DefaultSeoMetadata slot="seo-metadata" metadata={story?.content.metadata} />
  <DefaultLayout global={global}>
    <PageNotFoundPage story={story} />
  </DefaultLayout>
</HtmlDocument>
