---
import { getGlobalStory } from '~/features/common/api'
import { getHomeStory } from '~/features/home/api'
import HtmlDocument from '~/features/common/HtmlDocument/index.astro'
import DefaultSeoMetadata from '~/features/common/DefaultSeoMetadata/index.astro'
import DefaultLayout from '~/features/common/DefaultLayout/index.astro'
import Page from '~/features/common/Page'
import StoryblokBridge from '~/features/storyblok/StoryblokBridge/index.astro'

const global = await getGlobalStory()

if (!global) {
  throw Error(`'Global' story not found.`)
}

const story = await getHomeStory()

if (!story) {
  return new Response(null, {
    status: 404,
    statusText: `'Home' story not found.`
  })
}
---

<HtmlDocument>
  <DefaultSeoMetadata slot="seo-metadata" metadata={story?.content.metadata} />

  <DefaultLayout global={global}>
    <Page story={story} />
  </DefaultLayout>

  <StoryblokBridge />
</HtmlDocument>
